#!/bin/bash

# –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Pydantic –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Pydantic –Ω–∞—Å—Ç—Ä–æ–µ–∫..."

cd backend/shared

# –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è
cp config.py config.py.backup

# –î–æ–±–∞–≤–ª—è–µ–º extra = "ignore" –∫–æ –≤—Å–µ–º Config –∫–ª–∞—Å—Å–∞–º
sed -i '/env_file = "\.env"$/a\        extra = "ignore"' config.py

echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å
if grep -q 'extra = "ignore"' config.py; then
    echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ extra = \"ignore\" –¥–æ–±–∞–≤–ª–µ–Ω–∞"
else
    echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É"
    echo "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏..."
    mv config.py.backup config.py
    exit 1
fi

echo "üöÄ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:"
echo "   cd ~/project && ./start-monolith-direct.sh"