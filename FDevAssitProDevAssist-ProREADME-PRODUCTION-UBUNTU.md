# DevAssist Pro - Production Deployment Guide

## Ubuntu 22.04 Server Deployment

**Target Server:** 46.149.71.162  
**OS:** Ubuntu 22.04  
**Deployment Mode:** Single Command Docker Monolith

---

## 🚀 Quick Start (One Command Deployment)

```bash
# Clone and deploy
git clone <repository-url>
cd DevAssist-Pro
./deploy-production.sh deploy
```

---

## 📋 Prerequisites

### System Requirements
- Ubuntu 22.04 LTS
- Minimum 2GB RAM
- 10GB free disk space
- Root or sudo access
- Internet connection

### Network Requirements
- Port 80 open (HTTP)
- Port 443 open (HTTPS, optional)
- SSH access (port 22)

---

## 📁 Project Structure

```
DevAssist-Pro/
├── frontend/
│   ├── Dockerfile.prod          # Production frontend build
│   └── nginx.frontend.conf      # Frontend nginx config
├── backend/
│   ├── api_gateway/
│   └── Dockerfile               # Backend service
├── nginx/
│   └── default.conf            # Main reverse proxy config
├── docker-compose.monolith.yml # Production compose file
├── deploy-production.sh        # One-command deployment
├── env.production.example      # Environment template
└── README-PRODUCTION-UBUNTU.md # This file
```

---

## 🔧 Configuration Files

### 1. Frontend Production Build
**File:** `frontend/Dockerfile.prod`
- Multi-stage React build
- Nginx static file serving
- Production optimizations
- Health checks

### 2. Nginx Reverse Proxy
**File:** `nginx/default.conf`
- API proxy (`/api/` → Backend:8000)
- WebSocket proxy (`/ws/` → Backend:8000)
- Static files (`/` → Frontend:80)
- Rate limiting and security headers

### 3. Docker Compose
**File:** `docker-compose.monolith.yml`
- PostgreSQL database
- Redis cache
- Backend API gateway
- Frontend build
- Nginx reverse proxy

---

## ⚙️ Environment Configuration

### 1. Copy Environment Template
```bash
cp env.production.example .env.production
```

### 2. Update Required Variables
```bash
# API Keys (REQUIRED)
ANTHROPIC_API_KEY=your_actual_anthropic_key
OPENAI_API_KEY=your_actual_openai_key
GOOGLE_API_KEY=your_actual_google_key

# Security (Auto-generated by script)
JWT_SECRET=auto_generated_32_char_secret
POSTGRES_PASSWORD=auto_generated_password
REDIS_PASSWORD=auto_generated_password
```

---

## 🐳 Deployment Process

### Automated Deployment (Recommended)
```bash
# Check system readiness
./deploy-production.sh check

# Deploy to production
./deploy-production.sh deploy
```

### Manual Deployment
```bash
# 1. Install Docker (if needed)
sudo apt update
sudo apt install docker.io docker-compose-plugin

# 2. Configure environment
cp env.production.example .env.production
# Edit .env.production with your API keys

# 3. Deploy services
docker compose -f docker-compose.monolith.yml --env-file .env.production up -d --build
```

---

## 🌐 Service Access

After successful deployment:

| Service | URL | Description |
|---------|-----|-------------|
| Frontend | http://46.149.71.162/ | React application |
| API | http://46.149.71.162/api/ | Backend API |
| Health | http://46.149.71.162/health | Service health check |
| WebSocket | ws://46.149.71.162/ws/ | Real-time connections |

---

## 📊 Service Architecture

```
Ubuntu Server (46.149.71.162:80)
│
├── Nginx Reverse Proxy
│   ├── Frontend Static Files (/)
│   ├── API Proxy (/api → Backend:8000)
│   ├── WebSocket Proxy (/ws → Backend:8000)
│   └── Health Check (/health)
│
├── Docker Network (172.20.0.0/16)
│   ├── Frontend Container (nginx:1.25-alpine)
│   ├── Backend Container (python:3.11-slim)
│   ├── PostgreSQL Container (postgres:15-alpine)
│   └── Redis Container (redis:7-alpine)
│
└── Persistent Volumes
    ├── postgres_data (Database storage)
    ├── redis_data (Cache storage)
    ├── backend_uploads (File uploads)
    └── backend_reports (Generated reports)
```

---

## 🔍 Management Commands

### Service Status
```bash
# Check all containers
docker compose -f docker-compose.monolith.yml ps

# Check service health
./deploy-production.sh health
```

### Logs and Monitoring
```bash
# View all logs
docker compose -f docker-compose.monolith.yml logs -f

# View specific service logs
docker compose -f docker-compose.monolith.yml logs -f frontend
docker compose -f docker-compose.monolith.yml logs -f api-gateway
docker compose -f docker-compose.monolith.yml logs -f postgres
```

### Service Control
```bash
# Stop all services
./deploy-production.sh stop

# Restart all services
./deploy-production.sh restart

# Manual service control
docker compose -f docker-compose.monolith.yml stop
docker compose -f docker-compose.monolith.yml start
docker compose -f docker-compose.monolith.yml restart
```

---

## 🛠 Troubleshooting

### Common Issues

#### 1. Port Already in Use
```bash
# Check what's using port 80
sudo netstat -tulpn | grep :80
sudo fuser -k 80/tcp
```

#### 2. Docker Permission Denied
```bash
# Add user to docker group
sudo usermod -aG docker $USER
newgrp docker
```

#### 3. Service Not Starting
```bash
# Check container logs
docker compose -f docker-compose.monolith.yml logs [service-name]

# Check system resources
df -h
free -m
```

#### 4. Database Connection Issues
```bash
# Check database container
docker compose -f docker-compose.monolith.yml exec postgres pg_isready -U devassist_user

# Test database connection
docker compose -f docker-compose.monolith.yml exec postgres psql -U devassist_user -d devassist_pro -c "SELECT 1;"
```

### Health Check URLs
```bash
# Test all endpoints
curl http://46.149.71.162/health
curl http://46.149.71.162/api/health
curl http://46.149.71.162/
```

---

## 🔒 Security Considerations

### 1. Firewall Configuration
```bash
# UFW firewall setup (done automatically by script)
sudo ufw allow ssh
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

### 2. Environment Security
- Store API keys securely
- Use strong database passwords
- Regular security updates
- Monitor access logs

### 3. SSL/HTTPS Setup (Optional)
```bash
# Install Certbot for Let's Encrypt
sudo apt install certbot python3-certbot-nginx

# Get SSL certificate
sudo certbot --nginx -d 46.149.71.162
```

---

## 📈 Performance Optimization

### 1. System Monitoring
```bash
# Monitor system resources
htop
docker stats

# Monitor disk usage
df -h
du -sh /var/lib/docker/
```

### 2. Log Management
```bash
# Configure log rotation
sudo nano /etc/docker/daemon.json
{
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
```

### 3. Database Optimization
```bash
# PostgreSQL performance tuning
docker compose -f docker-compose.monolith.yml exec postgres psql -U devassist_user -d devassist_pro
# Run: VACUUM ANALYZE;
```

---

## 💾 Backup and Recovery

### 1. Database Backup
```bash
# Create database backup
docker compose -f docker-compose.monolith.yml exec postgres pg_dump -U devassist_user devassist_pro > backup_$(date +%Y%m%d).sql

# Restore database backup
docker compose -f docker-compose.monolith.yml exec -T postgres psql -U devassist_user devassist_pro < backup_20241220.sql
```

### 2. Volume Backup
```bash
# Backup all volumes
docker run --rm -v devassist_postgres_data:/data -v $(pwd):/backup alpine tar czf /backup/postgres_backup.tar.gz /data

# Restore volume
docker run --rm -v devassist_postgres_data:/data -v $(pwd):/backup alpine tar xzf /backup/postgres_backup.tar.gz -C /
```

---

## 🆘 Support and Maintenance

### Regular Maintenance Tasks
1. **Weekly:** Check logs and system resources
2. **Monthly:** Update Docker images and system packages
3. **Quarterly:** Review security configurations
4. **As needed:** Database backups and cleanup

### Update Deployment
```bash
# Pull latest code
git pull origin main

# Rebuild and deploy
./deploy-production.sh deploy
```

### Emergency Procedures
```bash
# Quick restart (minimal downtime)
docker compose -f docker-compose.monolith.yml restart

# Full rebuild (more downtime, fresh start)
docker compose -f docker-compose.monolith.yml down
docker compose -f docker-compose.monolith.yml up -d --build
```

---

## 📞 Support Information

- **Repository:** [DevAssist Pro GitHub](https://github.com/your-repo/devassist-pro)
- **Documentation:** This README file
- **Logs Location:** `docker compose -f docker-compose.monolith.yml logs`
- **Configuration:** `.env.production` file

---

**Last Updated:** December 2024  
**Version:** 1.0 Production Ready  
**Target Environment:** Ubuntu 22.04 Server