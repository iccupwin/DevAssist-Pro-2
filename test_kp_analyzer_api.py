#!/usr/bin/env python3
"""
–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –¢–ï–°–¢: –ü—Ä–æ–≤–µ—Ä–∫–∞ API KP –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π
"""
import json
import logging
from datetime import datetime

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

def test_kp_analyzer_api():
    """–¢–µ—Å—Ç API KP –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞"""
    logger.info("üöÄ –¢–ï–°–¢ API KP –ê–ù–ê–õ–ò–ó–ê–¢–û–†–ê –° –ö–ò–†–ò–õ–õ–ò–¶–ï–ô")
    logger.info("=" * 60)
    
    try:
        import requests
        import time
        
        # URL API
        base_url = "http://localhost:8000"
        analyze_url = f"{base_url}/api/kp-analyzer/analyze"
        export_url = f"{base_url}/api/kp-analyzer/export-pdf"
        
        # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ
        test_kp_text = """
        –ö–û–ú–ú–ï–†–ß–ï–°–ö–û–ï –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ï
        
        –ö–æ–º–ø–∞–Ω–∏—è: –û–û–û ¬´–¢–µ—Ö–Ω–æ–õ–∏–¥–µ—Ä¬ª
        –ü—Ä–æ–µ–∫—Ç: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤–µ–±-–ø–æ—Ä—Ç–∞–ª–∞ –¥–ª—è –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
        
        –û–ü–ò–°–ê–ù–ò–ï –ü–†–û–ï–ö–¢–ê:
        –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤–µ–±-–ø–æ—Ä—Ç–∞–ª–∞ –¥–ª—è –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ ¬´–ü—Ä–µ–º–∏—É–º –≠—Å—Ç–µ–π—Ç¬ª 
        —Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º –ø–æ–∏—Å–∫–∞, –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –æ–±—ä–µ–∫—Ç–æ–≤, –æ–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π –∏ CRM —Å–∏—Å—Ç–µ–º–æ–π.
        
        –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –•–ê–†–ê–ö–¢–ï–†–ò–°–¢–ò–ö–ò:
        ‚Ä¢ Backend: Python 3.11, FastAPI
        ‚Ä¢ Frontend: React 18, TypeScript
        ‚Ä¢ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL 15
        ‚Ä¢ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: Redis
        ‚Ä¢ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è: Docker, Kubernetes
        ‚Ä¢ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: Grafana, Prometheus
        
        –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò:
        1. –ö–∞—Ç–∞–ª–æ–≥ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
        2. –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –∞–≥–µ–Ω—Ç–æ–≤
        3. –°–∏—Å—Ç–µ–º–∞ –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
        4. CRM –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑–æ–π
        5. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–Ω–∫–∞–º–∏ –¥–ª—è –∏–ø–æ—Ç–µ–∫–∏
        6. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤
        
        –°–¢–û–ò–ú–û–°–¢–¨ –ò –°–†–û–ö–ò:
        –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞: 1 500 000 ‚ÇΩ (–≤–∫–ª—é—á–∞—è –ù–î–°)
        –°—Ä–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 90 —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π (3 –º–µ—Å—è—Ü–∞)
        –ì–∞—Ä–∞–Ω—Ç–∏—è: 12 –º–µ—Å—è—Ü–µ–≤
        –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞: 50 000 ‚ÇΩ/–º–µ—Å—è—Ü
        
        –≠–¢–ê–ü–´ –í–´–ü–û–õ–ù–ï–ù–ò–Ø:
        1. –ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (20 –¥–Ω–µ–π) - 300 000 ‚ÇΩ
        2. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ MVP (40 –¥–Ω–µ–π) - 800 000 ‚ÇΩ
        3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞ (20 –¥–Ω–µ–π) - 250 000 ‚ÇΩ
        4. –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∏ –æ–±—É—á–µ–Ω–∏–µ (10 –¥–Ω–µ–π) - 150 000 ‚ÇΩ
        
        –ö–û–ú–ê–ù–î–ê –ü–†–û–ï–ö–¢–ê:
        ‚Ä¢ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞: –ò–≤–∞–Ω–æ–≤ –ò.–ò. (5 –ª–µ—Ç –æ–ø—ã—Ç–∞)
        ‚Ä¢ –í–µ–¥—É—â–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: –ü–µ—Ç—Ä–æ–≤ –ü.–ü. (7 –ª–µ—Ç –æ–ø—ã—Ç–∞)
        ‚Ä¢ Frontend —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: –°–∏–¥–æ—Ä–æ–≤–∞ –°.–°. (4 –≥–æ–¥–∞ –æ–ø—ã—Ç–∞)
        ‚Ä¢ DevOps –∏–Ω–∂–µ–Ω–µ—Ä: –ö–æ–∑–ª–æ–≤ –ö.–ö. (6 –ª–µ—Ç –æ–ø—ã—Ç–∞)
        ‚Ä¢ –¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫: –ú–æ—Ä–æ–∑–æ–≤–∞ –ú.–ú. (3 –≥–æ–¥–∞ –æ–ø—ã—Ç–∞)
        
        –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–°–õ–£–ì–ò:
        ‚Ä¢ SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: 100 000 ‚ÇΩ
        ‚Ä¢ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏: 50 000 ‚ÇΩ
        ‚Ä¢ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–æ—Ü—Å–µ—Ç—è–º–∏: 75 000 ‚ÇΩ
        ‚Ä¢ –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: 125 000 ‚ÇΩ
        
        –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –¥–æ: 31.12.2024
        –ö–æ–Ω—Ç–∞–∫—Ç: info@technoleader.ru, +7 (495) 123-45-67
        """
        
        test_tz_text = """
        –¢–ï–•–ù–ò–ß–ï–°–ö–û–ï –ó–ê–î–ê–ù–ò–ï
        
        –ü—Ä–æ–µ–∫—Ç: –í–µ–±-–ø–æ—Ä—Ç–∞–ª –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ ¬´–ü—Ä–µ–º–∏—É–º –≠—Å—Ç–µ–π—Ç¬ª
        
        –¶–ï–õ–ò –ü–†–û–ï–ö–¢–ê:
        1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –≤–µ–±-–ø–æ—Ä—Ç–∞–ª–∞ –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏/–∞—Ä–µ–Ω–¥—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
        2. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ —Ä–∞–±–æ—Ç—ã —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏
        3. –ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
        4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏ API
        
        –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
        
        1. –ö–ê–¢–ê–õ–û–ì –ù–ï–î–í–ò–ñ–ò–ú–û–°–¢–ò:
        ‚Ä¢ –ü–æ–∏—Å–∫ –ø–æ —Ç–∏–ø—É, —Ü–µ–Ω–µ, —Ä–∞–π–æ–Ω—É, –ø–ª–æ—â–∞–¥–∏
        ‚Ä¢ –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º –æ–±—ä–µ–∫—Ç–æ–≤
        ‚Ä¢ –ö–∞—Ä—Ç–∞ —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π –æ–±—ä–µ–∫—Ç–æ–≤
        ‚Ä¢ –§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ–∏ –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ç—É—Ä—ã
        ‚Ä¢ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
        
        2. –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–¨–°–ö–ò–ï –ê–ö–ö–ê–£–ù–¢–´:
        ‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –∞–≥–µ–Ω—Ç–æ–≤
        ‚Ä¢ –õ–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏
        ‚Ä¢ –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –∏ –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
        ‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –æ–±—ä–µ–∫—Ç–∞—Ö
        
        3. CRM –°–ò–°–¢–ï–ú–ê:
        ‚Ä¢ –ë–∞–∑–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏ –ª–∏–¥–æ–≤
        ‚Ä¢ –ò—Å—Ç–æ—Ä–∏—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–π
        ‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –≤—Å—Ç—Ä–µ—á –∏ –∑–≤–æ–Ω–∫–æ–≤
        ‚Ä¢ –û—Ç—á–µ—Ç–Ω–æ—Å—Ç—å –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º
        
        4. –ò–ù–¢–ï–ì–†–ê–¶–ò–ò:
        ‚Ä¢ API –±–∞–Ω–∫–æ–≤ –¥–ª—è –∏–ø–æ—Ç–µ—á–Ω–æ–≥–æ –∫—Ä–µ–¥–∏—Ç–æ–≤–∞–Ω–∏—è
        ‚Ä¢ –†–æ—Å—Ä–µ–µ—Å—Ç—Ä –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
        ‚Ä¢ –°–∏—Å—Ç–µ–º—ã –æ–Ω–ª–∞–π–Ω-–ø–ª–∞—Ç–µ–∂–µ–π
        ‚Ä¢ Email –∏ SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        
        –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø:
        ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 1000+ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        ‚Ä¢ –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–µ –±–æ–ª–µ–µ 2 —Å–µ–∫—É–Ω–¥
        ‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        ‚Ä¢ SEO –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ –≤—ã—Å–æ–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
        ‚Ä¢ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 152-–§–ó
        ‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
        
        –ë–Æ–î–ñ–ï–¢: –¥–æ 2 000 000 ‚ÇΩ
        –°–†–û–ö–ò: –Ω–µ –±–æ–ª–µ–µ 4 –º–µ—Å—è—Ü–µ–≤
        
        –ö–†–ò–¢–ï–†–ò–ò –û–¶–ï–ù–ö–ò –ü–†–ï–î–õ–û–ñ–ï–ù–ò–ô:
        ‚Ä¢ –¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ (30%)
        ‚Ä¢ –°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ (25%)
        ‚Ä¢ –û–ø—ã—Ç –∫–æ–º–∞–Ω–¥—ã (20%)
        ‚Ä¢ –°—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (15%)
        ‚Ä¢ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ (10%)
        """
        
        # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
        analysis_data = {
            "kp_content": test_kp_text,
            "tz_content": test_tz_text,
            "analysis_type": "detailed",
            "export_format": "pdf"
        }
        
        logger.info("üìä –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–Ω–∞–ª–∏–∑ –ö–ü...")
        
        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –∞–Ω–∞–ª–∏–∑
        try:
            headers = {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
            
            response = requests.post(
                analyze_url, 
                json=analysis_data, 
                headers=headers,
                timeout=120  # 2 –º–∏–Ω—É—Ç—ã —Ç–∞–π–º–∞—É—Ç –¥–ª—è AI –∞–Ω–∞–ª–∏–∑–∞
            )
            
            if response.status_code == 200:
                analysis_result = response.json()
                logger.info("‚úÖ –ê–Ω–∞–ª–∏–∑ –ö–ü –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!")
                logger.info(f"üìà –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: {analysis_result.get('overall_score', 'N/A')}/100")
                
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞
                with open('kp_analysis_result.json', 'w', encoding='utf-8') as f:
                    json.dump(analysis_result, f, ensure_ascii=False, indent=2)
                
                logger.info("üíæ –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ kp_analysis_result.json")
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
                result_str = json.dumps(analysis_result, ensure_ascii=False)
                if any(ord(char) > 127 for char in result_str):
                    logger.info("‚úÖ –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ –≤ JSON –æ—Ç–≤–µ—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
                else:
                    logger.warning("‚ö†Ô∏è –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ –≤ –æ—Ç–≤–µ—Ç–µ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞")
                
                # –¢–µ—Å—Ç–∏—Ä—É–µ–º —ç–∫—Å–ø–æ—Ä—Ç –≤ PDF
                logger.info("üìÑ –¢–µ—Å—Ç–∏—Ä—É–µ–º —ç–∫—Å–ø–æ—Ä—Ç –≤ PDF...")
                
                pdf_data = {
                    "analysis_data": analysis_result,
                    "export_options": {
                        "include_charts": True,
                        "include_recommendations": True,
                        "format": "detailed"
                    }
                }
                
                pdf_response = requests.post(
                    export_url,
                    json=pdf_data,
                    headers={'Content-Type': 'application/json'},
                    timeout=60
                )
                
                if pdf_response.status_code == 200:
                    # –°–æ—Ö—Ä–∞–Ω—è–µ–º PDF
                    pdf_filename = f"kp_analysis_cyrillic_test_{datetime.now().strftime('%Y%m%d_%H%M%S')}.pdf"
                    
                    with open(pdf_filename, 'wb') as f:
                        f.write(pdf_response.content)
                    
                    logger.info(f"‚úÖ PDF —ç–∫—Å–ø–æ—Ä—Ç —É—Å–ø–µ—à–µ–Ω: {pdf_filename}")
                    logger.info(f"üìè –†–∞–∑–º–µ—Ä PDF: {len(pdf_response.content):,} –±–∞–π—Ç")
                    
                    # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
                    if len(pdf_response.content) > 50000:
                        logger.info("üéâ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –¢–ï–°–¢ –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û!")
                        logger.info("‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∏—Ä–∏–ª–ª–∏—Ü–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
                        logger.info("üìã –û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π PDF –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞")
                        return True
                    else:
                        logger.error("‚ùå PDF —Ñ–∞–π–ª —Å–ª–∏—à–∫–æ–º –º–∞–ª - –≤–æ–∑–º–æ–∂–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã")
                        return False
                else:
                    logger.error(f"‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ PDF: {pdf_response.status_code}")
                    logger.error(pdf_response.text)
                    return False
                
            else:
                logger.error(f"‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: {response.status_code}")
                logger.error(response.text)
                return False
                
        except requests.exceptions.ConnectionError:
            logger.error("‚ùå –û–®–ò–ë–ö–ê: –ù–µ —É–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É")
            logger.error("–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω –Ω–∞ http://localhost:8000")
            return False
            
        except requests.exceptions.Timeout:
            logger.error("‚ùå –û–®–ò–ë–ö–ê: –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ (–∞–Ω–∞–ª–∏–∑ –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏)")
            return False
            
    except ImportError:
        logger.error("‚ùå –î–ª—è —Ç–µ—Å—Ç–∞ –Ω—É–∂–Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ requests: pip install requests")
        return False
        
    except Exception as e:
        logger.error(f"‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞: {e}")
        import traceback
        logger.error(traceback.format_exc())
        return False

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Ç–µ—Å—Ç–∞ API"""
    logger.info("üöÄ –ó–ê–ü–£–°–ö –ö–†–ò–¢–ò–ß–ï–°–ö–û–ì–û –¢–ï–°–¢–ê API KP –ê–ù–ê–õ–ò–ó–ê–¢–û–†–ê")
    logger.info(f"üìÖ –í—Ä–µ–º—è: {datetime.now().strftime('%d.%m.%Y %H:%M:%S')}")
    logger.info("=" * 60)
    
    success = test_kp_analyzer_api()
    
    logger.info("")
    logger.info("=" * 60)
    
    if success:
        logger.info("üéâ API –¢–ï–°–¢ –ü–†–û–®–ï–õ –£–°–ü–ï–®–ù–û!")
        logger.info("‚úÖ –ö–ü –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ")
    else:
        logger.info("‚ùå API –¢–ï–°–¢ –ó–ê–í–ï–†–®–ò–õ–°–Ø –° –û–®–ò–ë–ö–ê–ú–ò!")
        logger.info("üîß –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ backend —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω")
    
    logger.info("=" * 60)

if __name__ == "__main__":
    main()