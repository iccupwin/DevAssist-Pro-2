#!/bin/bash

# DevAssist Pro - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ backend

echo "üõë DevAssist Pro - –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–Ω–æ–ª–∏—Ç–Ω–æ–≥–æ backend"

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ PID —Ñ–∞–π–ª—É
if [ -f "app.pid" ]; then
    PID=$(cat app.pid)
    echo "üìã –ù–∞–π–¥–µ–Ω PID —Ñ–∞–π–ª: $PID"
    
    if kill -0 $PID 2>/dev/null; then
        echo "üîÑ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ $PID..."
        kill $PID
        sleep 3
        
        if kill -0 $PID 2>/dev/null; then
            echo "‚ö° –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
            kill -9 $PID
        fi
        
        echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    else
        echo "‚ö†Ô∏è  –ü—Ä–æ—Ü–µ—Å—Å —Å PID $PID —É–∂–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
    fi
    
    rm -f app.pid
else
    echo "üìÅ PID —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python..."
fi

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ app
echo "üîç –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ DevAssist Pro..."
pkill -f "python.*app.py" 2>/dev/null && echo "‚úÖ Python –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã" || echo "‚ÑπÔ∏è  –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö Python –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
pkill -f "uvicorn" 2>/dev/null && echo "‚úÖ Uvicorn –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã" || echo "‚ÑπÔ∏è  –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö Uvicorn –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –≤—Å–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ..."
if curl -s http://localhost:8000/health >/dev/null 2>&1; then
    echo "‚ö†Ô∏è  Backend –≤—Å–µ –µ—â–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8000"
    echo "–í–æ–∑–º–æ–∂–Ω–æ, –∑–∞–ø—É—â–µ–Ω Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä?"
    echo "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: docker ps | grep devassist"
else
    echo "‚úÖ Backend —É—Å–ø–µ—à–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi

echo ""
echo "üìã –î–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–Ω–æ–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:"
echo "   ./start-monolith-direct.sh"
echo ""